---
import { Image } from 'astro:assets';
import Button from './Button.astro';

// Import category images
import mysticImg from '../images/categories/NEW Mystic_.webp';
import trueStoryImg from '../images/categories/NEW True Story.webp';
import trueCrimeImg from '../images/categories/NEW True Crime.webp';
import paranormalImg from '../images/categories/NEW Paranormal.webp';
import creatureImg from '../images/categories/NEW Creature.webp';
import newsImg from '../images/categories/NEW News.webp';
import filmreviewImg from '../images/categories/NEW Filmreview.webp';
import halloweenImg from '../images/categories/NEW Halloween.webp';
import creepypastaImg from '../images/categories/NEW Creepypasta.webp';
import spookylivereportImg from '../images/categories/NEW_SpookyLiveReport.webp';
import projecteverestImg from '../images/categories/NEW Project Everest.webp';

// Create category to image mapping
const categoryImages = {
	'mystic': mysticImg,
	'true story': trueStoryImg,
	'true crime': trueCrimeImg,
	'paranormal': paranormalImg,
	'creature': creatureImg,
	'news': newsImg,
	'filmreview': filmreviewImg,
	'halloween': halloweenImg,
	'creepypasta': creepypastaImg,
	'projecteverest': projecteverestImg,
	'spookylivereport': spookylivereportImg,
};

export interface Props {
	episode: {
		id: string;
		title: string;
		slug: string;
		description: string;
		pubDate: string;
		duration: string;
		audioUrl: string;
		category: string;
		guid: string;
	};
}

const { episode } = Astro.props;
const categoryImage = categoryImages[episode.category as keyof typeof categoryImages] || mysticImg;
---

<div class="rounded-lg p-4 shadow-lg hover:shadow-xl transition-shadow duration-300" style="background-color: #30293e;">
	<div class="flex items-center gap-4 mb-3">
		<div class="w-24 h-24 rounded overflow-hidden flex-shrink-0">
			<Image src={categoryImage} alt={episode.title} class="w-full h-full object-cover" width={192} height={192} sizes="96px" quality={90} />
		</div>
		<div class="flex-1 min-w-0">
			<div class="flex items-start justify-between gap-4">
				<div class="flex-1 min-w-0">
					<p class="text-xs uppercase tracking-wide mb-1" style="color: #41bf77;">#{episode.category.toUpperCase()}</p>
					<a href={`/episode/${episode.slug}`} class="font-bold text-xl hover:opacity-80 transition-opacity duration-300 block break-words">{episode.title}</a>
					<p class="text-md opacity-70 mt-1">Dauer: {episode.duration} • Veröffentlicht am {episode.pubDate}</p>
				</div>
				<div class="flex items-center gap-2 flex-shrink-0">
					<Button href={`/episode/${episode.slug}`} size="sm">Details</Button>
				</div>
			</div>
		</div>
	</div>
	<div>
		<div class="mb-4">
			<audio class="episode-player" controls preload="none">
				<source src={episode.audioUrl} type="audio/mpeg" />
				Your browser does not support the audio element.
			</audio>
		</div>
		<div class="episode-description text-md opacity-80 line-clamp-2 transition-all duration-300 break-words text-white" set:html={episode.description}></div>
		<div class="flex justify-center mt-3">
			<button class="opacity-60 hover:opacity-80 transition-opacity duration-300" onclick="toggleDescription(this)">
				<svg class="w-6 h-6 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
				</svg>
			</button>
		</div>
	</div>
</div>

<style>
.line-clamp-2 {
	display: -webkit-box;
	-webkit-line-clamp: 2;
	-webkit-box-orient: vertical;
	overflow: hidden;
	word-wrap: break-word;
	overflow-wrap: break-word;
}
</style>
